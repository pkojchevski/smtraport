var app=angular.module("myApp",["ngRoute","ngMessages","myApp.controllers","myApp.services","myApp.directives","720kb.datepicker","myApp.filters","angular-growl"]).constant("_",window._);app.config(["growlProvider",function(a){a.globalTimeToLive(3e3)}]),app.config(["$routeProvider","$httpProvider","growlProvider",function(a,b,c){a.when("/login",{templateUrl:"views/login.html",controller:"loginController"}).when("/daily",{templateUrl:"views/daily.html",controller:"dailyController"}).when("/weekly",{templateUrl:"views/weekly.html",controller:"weeklyController"}).when("/monthly",{templateUrl:"views/monthly.html",controller:"monthlyController"}).when("/yearly",{templateUrl:"views/yearly.html",controller:"yearlyController"}).when("/capacity",{templateUrl:"views/capacity.html",controller:"capacityController",resolve:{loggedin:checkLoggedIn}}).otherwise({redirectTo:"/"}),b.interceptors.push(function(a,b,c,d){return{response:function(a){return c.unauthorized=!0,a},responseError:function(c){return 401===c.status?(b.url("/login"),a.reject(c)):404===c.status?(b.url("/login"),console.log("user not found"),a.reject(c)):void 0}}}),c.globalPosition("bottom-center")}]);var checkLoggedIn=function(a,b,c,d,e){var f=a.defer();return c.get("http://localhost:3000/loggedin").success(function(a){e.errorMessage=null,0!=a?(console.log("checkLoggedIn"),e.currentUser=a,"admin"===a.role&&(e.checkRole="false"),"admin"!==a.role&&(e.checkRole="true"),f.resolve()):(e.errorMessage="You need to login",f.reject(),b.url("/login"))}),console.dir("deferred.promise:"+JSON.stringify(f.promise)),f.promise};app.config(function(a){a.defaults.headers.common={},a.defaults.headers.put["Content-Type"]="application/json",a.defaults.headers.post["Content-Type"]="application/json",a.defaults.headers.delete={},a.defaults.headers.patch={},a.defaults.headers.options={}}),angular.module("myApp.controllers").controller("NavCtrl",["$scope","$location","SecurityService",function(a,b,c){a.logout=function(){c.logout(function(a){console.log("Logout!"),b.url("/")})}}]),angular.module("myApp.controllers").controller("capacityController",["$scope","$filter","products","productService","messages","productsByOpis",function(a,b,c,d,e,f){a.productIndex="",a.productOpis="",a.submitted=!1,a.searchProducts=function(){""===a.productIndex&&""===a.productOpis&&c.query().$promise.then(function(b){a.products=b}),""!==a.productIndex&&""===a.productOpis&&c.get({productIndex:a.productIndex}).$promise.then(function(b){a.products=[],a.products.push(b)}),""!==a.productOpis&&""===a.productIndex&&(console.log("opissssssssssssss"),f.query({description:a.productOpis}).$promise.then(function(b){a.products=b}))},a.editProduct=function(b){a.id=b._id,a.productIndex=b.productIndex,a.productOpis=b.description,a.pcbsnapanel=b.pcbsonpanel,a.pcbsnagodzina=b.pcbs100},a.deleteProduct=function(b){d.delete({id:b._id},function(b){console.log(b),e("delete"),a.products=[],console.log("list is updated")})},a.addProduct=function(f){if(a.submitted=!0,console.log("submit button is clicked"),console.log("!capacityForm.opis.$pristine:"+!a.capacityForm.opis.$pristine),console.log("capacityForm.opis.$invalid:"+a.capacityForm.opis.$invalid),console.log("isValid:"+f),f){var g,h={_id:a.id||"",productIndex:a.productIndex,description:a.productOpis,pcbsonpanel:a.pcbsnapanel,pcbs100:a.pcbsnagodzina};c.query().$promise.then(function(f){g=b("findId")(h._id,f),g?d.update({id:a.id},h).$promise.then(function(b){a.clearFields(),a.capacityForm.$setPristine(),a.capacityForm.$setValidity(),a.capacityForm.$setUntouched(),e("update")}):c.save(h,function(b){a.clearFields(),e("add")})})}},a.clearFields=function(){a.id="",a.productIndex="",a.productOpis="",a.pcbsnapanel="",a.pcbsnagodzina="",a.products=[],a.capacityForm.$setPristine(),a.capacityForm.$setValidity(),a.capacityForm.$setUntouched()}}]),angular.module("myApp.controllers",[]).controller("dailyController",["$scope","$timeout","$http","$filter","dailyProduct","dailyProductService","columnChart","pieChart","dailyRecord","dailyRecordService","weeklyRecord","weeklyRecordService","dailyRecordServiceDel","weeklyProduct","dailyRecordServiceDel","weeklyProductService","columnCharPP","dailyRecordByDate","dailyProductByDate","_","weeklyProductForData",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,m,o,p,q,r,s,t){function u(){console.log("init is runing"),a.hour=["06-07","07-08","08-09","09-10","10-11","11-12","12-13","13-14","14-15","15-16","16-17","17-18","18-19","19-20","20-21","21-22"],a.prodData={efficiency:["eff[%]",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],lineOpened:["Lin.Otwarta[min]",60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60],lineClosed:["Lin.Zamkn.[min]",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],lineEff:["Lin.Eff.[min]",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],npStops:["Niepl.Przest.[min]",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],target:["cel[%]",80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80],product1:["#pcbs/g",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],product2:["#pcbs/g",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],product3:["#pcbs/g",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],product4:["#pcbs/g",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],product5:["#pcbs/g",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],product6:["#pcbs/g",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],product7:["#pcbs/g",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],product8:["#pcbs/g",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],product9:["#pcbs/g",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],product10:["#pcbs/g",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},a.np={modelChange:["Zmiana modelu","",0,0,0,0,0,0,0,,0,0,0,0,0,0,0,0,0],changeSide:["Zmiana strony","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],changeVersion:["Zmiana wer.rynk.","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],missingComponent:["Brak komponentu","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],componentVerification:["Werifikacja komponentu","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],wrongPlStencil:["Żłe ułożony szablon","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],damagedStencil:["Uszkodzony szablon","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],DrukCleaningStencil:["Drukarka:Czyszczenie szablonu","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],DrukAddingPaste:["Drukarka:Dodanie pasty","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],DrukDodanieVigon:["Drukarka:Dodanie vigon","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],DrukProgramCorrection:["Drukarka:Korekprog","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],DrukPaperChange:["Drukarka:Wympapieru","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],PNPBadmark:["PNP:Badmarki","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],PNPpickComponent:["PNP:pobieranie komponentu","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],PNPprogramCorrection:["PNP:Korekcja programu","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],PNPtrayChange:["PNP:wymiana tacki","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],PNPcleaningNozzle:["PNP:czyszczenie ssawek","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],PNPfeederChange:["PNP:wymiana feedera","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],PNPripedFoil:["PNP:Zerwana taśma","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Reflow:["Piec","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],AOIcorrection:["AOI korekcja programu","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Transport:["Transport","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Separation:["Separacja płytek","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Validation:["Walidacja 1 płytki","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],othernp1:["Inny","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],othernp2:["Inny","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],othernp3:["Inny","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},a.pp={linePreparing:["Przygotow.Linii","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],meeting:["Zebranie","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],pause:["Przerwa","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],noPlan:["Zakończenie plany","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],preventive:["Konserwacja","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],inventory:["Inwentura","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],testy:["Testy(Trace, NPI,..)","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],missOperator:["Brak operatorów","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],missComponent:["Brak Komponentów","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],qualityIssue:["Problem Jakościowy","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],otherpp1:["inny","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],otherpp2:["inny","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],otherpp3:["inny","",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},a.dailyRecords=[{dailyRecordsId:"",arrName:"",arrIndex:"",arrIndexValue:""}],a.product={},a.products=[product1={},product2={},product3={},product4={},product5={},product6={},product7={},product8={},product9={},product10={}],a.prodDataTot={efficiencyTot:[0,0,0],lineOpenedTot:[0,0,0,0],lineClosedTot:[0,0,0,0],lineEffTot:[0,0,0,0],npStopsTot:[0,0,0,0],targetTot:[0,0,0],product1Tot:[0,0,0],product2Tot:[0,0,0],product3Tot:[0,0,0],product4Tot:[0,0,0],product5Tot:[0,0,0],product6Tot:[0,0,0],product7Tot:[0,0,0],product8Tot:[0,0,0],product9Tot:[0,0,0],product10Tot:[0,0,0]},a.ppTot={linePreparingTot:[0,0,0,0],meetingTot:[0,0,0,0],pauseTot:[0,0,0,0],noPlanTot:[0,0,0,0],preventiveTot:[0,0,0,0],inventoryTot:[0,0,0,0],testyTot:[0,0,0,0],missOperatorTot:[0,0,0,0],missComponentTot:[0,0,0,0],qualityIssueTot:[0,0,0,0],otherpp1Tot:[0,0,0,0],otherpp2Tot:[0,0,0,0],otherpp3Tot:[0,0,0,0]},a.npTot={modelChangeTot:[0,0,0,0],changeSideTot:[0,0,0,0],changeVersionTot:[0,0,0,0],missingComponentTot:[0,0,0,0],componentVerificationTot:[0,0,0,0],wrongPlStencilTot:[0,0,0,0],damagedStencilTot:[0,0,0,0],DrukCleaningStencilTot:[0,0,0,0],DrukAddingPasteTot:[0,0,0,0],DrukDodanieVigonTot:[0,0,0,0],DrukProgramCorrectionTot:[0,0,0,0],DrukPaperChangeTot:[0,0,0,0],PNPBadmarkTot:[0,0,0,0],PNPpickComponentTot:[0,0,0,0],PNPprogramCorrectionTot:[0,0,0,0],PNPtrayChangeTot:[0,0,0,0],PNPcleaningNozzleTot:[0,0,0,0],PNPfeederChangeTot:[0,0,0,0],PNPripedFoilTot:[0,0,0,0],ReflowTot:[0,0,0,0],AOIcorrectionTot:[0,0,0,0],TransportTot:[0,0,0,0],SeparationTot:[0,0,0,0],ValidationTot:[0,0,0,0],othernp1Tot:[0,0,0,0],othernp2Tot:[0,0,0,0],othernp3Tot:[0,0,0,0]}}a.buttonClicked=!1,a.productionDate=(new Date).toJSON().slice(0,10),console.log("productionDate:"+a.productionDate),a.ppDailyChart=[],a.npDailyChart=[],a._=s,u();var v=function(){r.query({prodData:a.productionDate}).$promise.then(function(b){for(var c=0;c<a.products.length;c++)a.products[c]=b[c];console.log("dailyproducts:"+JSON.stringify(a.products))})};a.saveShowProductsDaily=function(a){console.log("save product:"+JSON.stringify(a)),e.save(a,function(a){v()})},v(),b(function(){a.refreshDailyData()},4e3),a.refreshDailyData=function(){q.query({prodData:a.productionDate}).$promise.then(function(b){for(var c=0;c<b.length;c++){var e=b[c].name.split(" ")[0],f=b[c].name.split(" ")[1],i=b[c].index,j=b[c].name;d("checkForNumbers")(j,parseInt(i),parseInt(b[c].value))&&(a.$eval(e+"."+f)[i]=b[c].value),d("checkForNumbers")(j,parseInt(i),parseInt(b[c].value))||(a.$eval(e+"."+f)[i]=b[c].details)}d("calcStops")(a.prodData.lineClosed,a.pp),d("calcStops")(a.prodData.npStops,a.np),a.prodData.lineOpened=d("getLineOpened")(a.prodData.lineClosed),a.prodData.efficiency=d("calcEffArr")(a.products,a.prodData.lineOpened,a.prodData),a.prodData.lineEff=d("calcLineEff")(a.prodData.efficiency,a.prodData.lineOpened),d("calcTot")(a.prodData,a.prodDataTot),d("calcTot")(a.pp,a.ppTot),d("calcTot")(a.np,a.npTot),a.prodDataTot.efficiencyTot[0]=d("calcAverageEff")(1,8,a.prodData.efficiency),a.prodDataTot.efficiencyTot[1]=d("calcAverageEff")(9,16,a.prodData.efficiency),a.prodDataTot.efficiencyTot[2]=d("calcAvgEffTot")(a.prodDataTot.efficiencyTot[1],a.prodDataTot.efficiencyTot[0]),d("calcRatioProdData")(a.prodDataTot),d("calcRatio")(a.npTot,a.prodDataTot,"npStopsTot"),d("calcRatio")(a.ppTot,a.prodDataTot,"lineClosedTot"),h(parseInt(a.prodDataTot.lineOpenedTot[3]),"Lotw.",parseInt(a.prodDataTot.lineClosedTot[3]),"PP","container1"),h(parseInt(a.prodDataTot.lineEffTot[3]),"Leff.",parseInt(a.prodDataTot.npStopsTot[3]),"NP","container2"),g(d("getArrayNumbers")(a.prodData.efficiency),d("getArrayNumbers")(a.prodData.target),a.hour,"container"),p(d("getEff")(a.ppTot),[],d("getNames")(a.pp),"container10"),p(d("getEff")(a.npTot),[],d("getNames")(a.np),"container11")})},a.addDailyRecord=function(a){i.get({recordId:a.recordId}).$promise.then(function(b){console.log("put data:"+JSON.stringify(b)),"{}"!==JSON.stringify(b)?j.update({recordId:a.recordId},a).$promise.then(function(a){console.log("record is updated")}):i.save(a,function(a){console.log("record is saved")})})},a.addWeeklyProduct=function(a){t.query({prodData:a.prodData}).$promise.then(function(b){var c;if(console.log("xyxyxyxyxyxyxy:"+JSON.stringify(b)),"[]"!==JSON.stringify(b)){c=angular.copy(a);for(var d=0;d<b.length;d++)b[d].productIndex===c.productIndex&&(c.dailyQuantity=parseInt(c.dailyQuantity)+parseInt(b[0].dailyQuantity),c._id=b[0]._id);o.update({id:c._id},c).$promise.then(function(a){console.log("product is updated")})}else n.save(a,function(a){console.log("product is saved!")});console.log("ooooooooooooooooo:"+JSON.stringify(a)),f.delete({id:a._id},function(a){console.log("success:"+JSON.stringify(a)),console.log("products deleted!")})})},a.addWeeklyRecord=function(a){k.get({weeklyRecordId:a.weeklyRecordId}).$promise.then(function(b){"{}"!==JSON.stringify(b)?(a._id=b._id,l.update({id:a._id},a).$promise.then(function(a){console.log("record is updated")})):k.save(a,function(a){console.log("record is saved")})})};var w=function(){for(var b,c,e,f={},g=d("getAllNames")(a.npTot,"npTot.",a.ppTot,"ppTot.",a.prodDataTot,"prodDataTot."),h=0;h<g.length;h++)0!==a.$eval(g[h])[2]&&g[h].indexOf("product")===-1&&(b=g[h].split(".")[1],b=b.substring(0,b.length-3),c=g[h].split(".")[0],c=c.substring(0,c.length-3),e=g[h],f={weeklyRecordId:b+h+a.productionDate,name:g[h],text:a.$eval(c+"."+b)[0],value:a.$eval(g[h])[2],dateOfProd:moment(a.productionDate),details:x(e)});i.query().$promise.then(function(a){for(var b=0;b<a.length;b++)m.delete({id:a[b]._id},function(a){console.log("delete records success")})})},x=function(b){var c=b.split(".")[0],d=b.split(".")[1];return"prodDataTot"!==c?a.$eval(c.substring(0,c.length-3)+"."+d.substring(0,d.length-3))[1]:""},y=function(){var b,c;e.query().$promise.then(function(d){for(c=0;c<d.length;c++)console.log("produuuuuuuuucts:"+JSON.stringify(d[c])),b=d[c],a.addWeeklyProduct(b)})};a.reset=function(){console.log("button clicked!"),y(),w(),a.product={},a.products=[product1={},product2={},product3={},product4={},product5={},product6={},product7={},product8={},product9={},product10={}],u(),h(parseInt(a.prodDataTot.lineOpenedTot[3]),"Lotw.",parseInt(a.prodDataTot.lineClosedTot[3]),"PP","container1"),h(parseInt(a.prodDataTot.lineEffTot[3]),"Leff.",parseInt(a.prodDataTot.npStopsTot[3]),"NP","container2"),g(d("getArrayNumbers")(a.prodData.efficiency),d("getArrayNumbers")(a.prodData.target),a.hour,"container"),p(d("getEff")(a.ppTot),[],d("getNames")(a.pp),"container10"),p(d("getEff")(a.npTot),[],d("getNames")(a.np),"container11")}}]),angular.module("myApp.controllers").controller("loginController",["$scope","$location","$rootScope","SecurityService","messages",function(a,b,c,d,e){a.login=function(c){console.log("user:"+c.username+" password:"+c.password),d.login(c,function(c){console.log("usuario:"+JSON.stringify(c)),"Unauthorized"===c?(e(c),a.user.username="",a.user.password=""):b.url("/daily")})}}]),angular.module("myApp.controllers").controller("monthlyController",["$scope",function(a){}]);var app=angular.module("myApp.controllers").controller("weeklyController",["$scope","$filter","$timeout","columnChart","pieChart","columnCharPP","weeklyProductForPeriod","weeklyRecordForPeriod",function(a,b,c,d,e,f,g,h){function i(a){var c,d,e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],f=[];if(a.length){f[0]={name:a[0].name,text:a[0].text,calweek:moment(a[0].dateOfProd,"YYYY-MM-DD").isoWeek(),values:[0,0,0,0,0,0,0],details:a[0].details},f[0].values[b("convertDayInNumber")(a[0].dateOfProd,e)]=parseInt(a[0].value);for(var g=1;g<a.length;g++){c=!0;var h=0;for(h=0;h<f.length;h++)f[h].text===a[g].text&&(c*=!1,d=h),f[h].text!==a[g].text&&(c*=!0,d=h);c||(f[d].values[b("convertDayInNumber")(a[g].dateOfProd,e)]=parseInt(a[g].value)),c&&(f[d+1]={name:a[g].name,text:a[g].text,calweek:moment(a[g].dateOfProd,"YYYY-MM-DD").isoWeek(),values:[0,0,0,0,0,0,0],details:a[g].details},f[d+1].values[b("convertDayInNumber")(a[g].dateOfProd,e)]=parseInt(a[g].value))}return f}return[]}function j(a){var c,d,e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],f=[];if(a.length){f[0]={productIndex:a[0].productIndex,pcbs100:a[0].pcbs100,calweek:moment(a[0].prodData,"YYYY-MM-DD").isoWeek(),pcbsonpanel:a[0].pcbsonpanel,description:a[0].description,productId:a[0].productId,weeklyQuantity:[0,0,0,0,0,0,0]},f[0].weeklyQuantity[b("convertDayInNumber")(a[0].prodData,e)]=parseInt(a[0].dailyQuantity);for(var g=1;g<a.length;g++){c=!0;var h=0;for(h=0;h<f.length;h++)f[h].productIndex===a[g].productIndex&&(c*=!1,d=h),f[h].productIndex!==a[g].productIndex&&(c*=!0,d=h);c||(f[d].weeklyQuantity[b("convertDayInNumber")(a[g].prodData,e)]+=parseInt(a[g].dailyQuantity)),c&&(f[d+1]={productIndex:a[g].productIndex,pcbs100:a[g].pcbs100,calweek:moment(a[g].prodData,"YYYY-MM-DD").isoWeek(),pcbsonpanel:a[g].pcbsonpanel,description:a[g].description,idProduct:a[g].idProduct,weeklyQuantity:[0,0,0,0,0,0,0]},f[d+1].weeklyQuantity[b("convertDayInNumber")(a[g].prodData,e)]=parseInt(a[g].dailyQuantity))}return f}return[]}a.day=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];var k=function(){g.query({date1:a.date,date2:a.secDate}).$promise.then(function(b){a.productsWeekly=j(b),console.log("weeeeeeeeeklyProducts:"+JSON.stringify(a.productsWeekly))})},l=function(){var b=0,c=0,d=0,e=[],f=[],g=[];h.query({date1:a.date,date2:a.secDate}).$promise.then(function(h){console.log("datafor weekly record for period:"+JSON.stringify(h));for(var j=0;j<h.length;j++)"prodDataTot"===h[j].name.split(".")[0]&&(g[c]=h[j],c+=1),"ppTot"===h[j].name.split(".")[0]&&(e[b]=h[j],b+=1),"npTot"===h[j].name.split(".")[0]&&(f[d]=h[j],d+=1);a.prodDataWeekly=i(g),a.ppTotWeekly=i(e),a.npTotWeekly=i(f)})};a.showDataForPeriod=function(){var g,h,i,j;k(),l(),c(function(){a.prodDataWeeklyTot=b("calcWeeklyRecordsTot")(a.prodDataWeekly),a.ppTotWeeklyTot=b("calcWeeklyRecordsTot")(a.ppTotWeekly),a.npTotWeeklyTot=b("calcWeeklyRecordsTot")(a.npTotWeekly),a.productsWeeklyTot=b("calcWeeklyProductsTot")(a.productsWeekly),console.log("$scope.npTotWeeklyTot:"+a.npTotWeeklyTot),console.log("$scope.ppTotWeeklyTot:"+JSON.stringify(a.ppTotWeeklyTot));for(var c=0;c<a.ppTotWeeklyTot.length;c++)a.ppTotWeeklyTot[c].values[1]=b("calcStopsPercent")(a.prodDataWeekly,a.ppTotWeekly,"prodDataTot.lineClosedTot",a.ppTotWeeklyTot[c].name);for(c=0;c<a.npTotWeeklyTot.length;c++)a.npTotWeeklyTot[c].values[1]=b("calcStopsPercent")(a.prodDataWeekly,a.npTotWeekly,"prodDataTot.npStopsTot",a.npTotWeeklyTot[c].name);for(c=0;c<a.prodDataWeeklyTot.length;c++)"prodDataTot.efficiencyTot"===a.prodDataWeeklyTot[c].name&&(a.prodDataWeeklyTot[c].values[0]=b("calcWeeklyEff")(a.prodDataWeekly)),"prodDataTot.lineClosedTot"===a.prodDataWeeklyTot[c].name&&(a.prodDataWeeklyTot[c].values[1]=b("calcWeeklyClosed")(a.prodDataWeeklyTot),h=parseInt(a.prodDataWeeklyTot[c].values[1])),"prodDataTot.lineOpenedTot"===a.prodDataWeeklyTot[c].name&&(a.prodDataWeeklyTot[c].values[1]=b("calcWeeklyLineOpened")(a.prodDataWeeklyTot),g=parseInt(a.prodDataWeeklyTot[c].values[1])),"prodDataTot.npStopsTot"===a.prodDataWeeklyTot[c].name&&(a.prodDataWeeklyTot[c].values[1]=b("calcWeeklynpStops")(a.prodDataWeeklyTot),j=parseInt(a.prodDataWeeklyTot[c].values[1])),"prodDataTot.lineEffTot"===a.prodDataWeeklyTot[c].name&&(a.prodDataWeeklyTot[c].values[1]=b("calcWeeklyLineEff")(a.prodDataWeeklyTot),i=parseInt(a.prodDataWeeklyTot[c].values[1]));e(g,"Lotw.",h,"PP","container3"),e(i,"Leff.",j,"NP","container4"),d(b("getWeeklyEff")(a.prodDataWeekly),[80,80,80,80,80,80,80],a.day,"container"),f(b("getStops")(a.ppTotWeeklyTot),[],b("getNamesFromArray")(a.ppTotWeeklyTot),"container5"),f(b("getStops")(a.npTotWeeklyTot),[],b("getNamesFromArray")(a.npTotWeeklyTot),"container6")},1500)}}]);angular.module("myApp.controllers").controller("yearlyController",["$scope",function(a){}]),angular.module("myApp.directives",[]).directive("pkListen",["$timeout","$filter","$rootScope","pieChart","columnChart","dailyProduct","dailyProductService","columnCharPP","dailyProductByDate","_",function(a,b,c,d,e,f,g,h,i,j){return{restrict:"A",link:function(a,c,f){var j,k,l;c.on("click",function(){c[0].select()}),c.on("keydown keypress change",function(a){j=document.activeElement,13===a.which&&j.blur()}),c.on("blur",function(){if(k=f.class.split(" ")[1],l=f.class.split(" ")[0],!isNaN(parseInt(c.val()))&&""!==c.val()&&b("checkForNumbers")(f.class,parseInt(f.id),parseInt(c.val()))){var j={recordId:f.id+k,name:f.class,index:f.id,value:c.val(),details:"",prodData:a.productionDate};if(console.log("dailyRec:"+JSON.stringify(j)),a.addDailyRecord(j),a.$eval(l+"."+k)[f.id]=c.val(),b("calcStops")(a.prodData.lineClosed,a.pp),b("calcStops")(a.prodData.npStops,a.np),a.prodData.lineOpened=b("getLineOpened")(a.prodData.lineClosed),a.prodData.efficiency=b("calcEffArr")(a.products,a.prodData.lineOpened,a.prodData),a.prodData.lineEff=b("calcLineEff")(a.prodData.efficiency,a.prodData.lineOpened),b("calcTot")(a.prodData,a.prodDataTot),b("calcTot")(a.pp,a.ppTot),b("calcTot")(a.np,a.npTot),a.prodDataTot.efficiencyTot[0]=b("calcAverageEff")(1,8,a.prodData.efficiency),a.prodDataTot.efficiencyTot[1]=b("calcAverageEff")(9,16,a.prodData.efficiency),a.prodDataTot.efficiencyTot[2]=b("calcAvgEffTot")(a.prodDataTot.efficiencyTot[1],a.prodDataTot.efficiencyTot[0]),b("calcRatioProdData")(a.prodDataTot),b("calcRatio")(a.npTot,a.prodDataTot,"npStopsTot"),b("calcRatio")(a.ppTot,a.prodDataTot,"lineClosedTot"),d(parseInt(a.prodDataTot.lineOpenedTot[3]),"Lotw.",parseInt(a.prodDataTot.lineClosedTot[3]),"PP","container1"),d(parseInt(a.prodDataTot.lineEffTot[3]),"Leff.",parseInt(a.prodDataTot.npStopsTot[3]),"NP","container2"),e(b("getArrayNumbers")(a.prodData.efficiency),b("getArrayNumbers")(a.prodData.target),a.hour,"container"),h(b("getEff")(a.ppTot),[],b("getNames")(a.pp),"container10"),h(b("getEff")(a.npTot),[],b("getNames")(a.np),"container11"),f.class.indexOf("product")!==-1){var m;i.query({prodData:a.productionDate}).$promise.then(function(b){for(var c=0;c<b.length;c++)m=parseInt(b[c].productId.substring(0,1)),0!==a.$eval("prodDataTot.product"+(m+1)+"Tot")[2]&&(b[c].dailyQuantity=a.$eval("prodDataTot.product"+(m+1)+"Tot")[2],g.update({id:b[c]._id},b[c]).$promise.then(function(a){}))})}}if(!b("checkForNumbers")(f.class,f.id,c.val())&&""!==c.val()){a.$eval(l+"."+k)[1]=c.val(),console.log("elem.vaaaaaaal()"+c.val());var j={recordId:f.id+k,name:f.class,index:f.id,value:"",details:c.val(),prodData:a.productionDate};a.addDailyRecord(j)}})}}}]).directive("pkListenProduct",["dailyProduct","products",function(a,b){return{restrict:"A",link:function(a,c,d){var e={};c.on("keydown keypress change",function(a){activeElement=document.activeElement,13===a.which&&activeElement.blur()});var f;c.on("blur",function(g){f=document.activeElement,console.log("attr.id:"+d.id),b.get({productIndex:c.val()}).$promise.then(function(b){console.log("products:"+JSON.stringify(b)),e._id="",e.productId=d.id+a.productionDate,e.productIndex=b.productIndex,e.description=b.description,e.pcbsonpanel=b.pcbsonpanel,e.pcbs100=b.pcbs100,e.prodData=a.productionDate,e.dailyQuantity="",a.saveShowProductsDaily(e)})})}}}]).directive("pkLeave",["$timeout","$filter",function(a,b,c){return{restrict:"A",link:function(c,d,e){d.on("blur",function(){a(function(){console.log("elem.val:"+d.val()),console.log("date in directive:"+c.date),c.secDate=b("addDays")(c.date,6)},1500)})}}}]).directive("scrollup",["$document",function(a){return{restrict:"A",link:function(b,c,d){c.on("click",function(){function b(a,c,d){if(!(d<0)){var e=c-a.scrollTop,f=e/d*10;setTimeout(function(){a.scrollTop=a.scrollTop+f,b(a,c,d-10)},10)}}b(a[0].body,0,500)})}}}]),angular.module("myApp.filters",[]).filter("getArrayNumbers",function(){return function(a){for(var b=[],c=1;c<a.length;c++)b.push(a[c]);return b}}).filter("lineRatio",function(){return function(a,b){return 0!==a?(100*a/(a+b)).toFixed(0):0}}).filter("getSumTot",function(){return function(a,b){for(var c=0,d=a;d<b.length;d++)c+=parseInt(b[d]);return c}}).filter("getAverage",function(){return function(a,b){for(var c=0,d=0,e=a;e<b.length;e++)0!==b[e]&&(c+=1,d+=b[e]);return 0!==c?d/c:0}}).filter("getSum",function(){return function(a,b,c){for(var d=0,e=a;e<=b;e++)d+=parseInt(c[e]);return d}}).filter("calculateEff",function(){return function(a,b,c,d){for(var e,f=0,g=0;g<a.length;g++)null!==a[g]&&"undefined"!=typeof a[g]&&(isNaN(a[g].pcbs100)||(f+=60/b*(d["product"+(g+1)][c]/a[g].pcbs100)));return e=parseInt((100*f).toFixed(0))}}).filter("calcEffArr",function(){return function(a,b,c){var d,e=[];e[0]="eff[%]";for(var f=1;f<b.length;f++){d=0;for(var g=0;g<=a.length;g++)null!==a[g]&&"undefined"!=typeof a[g]&&(isNaN(a[g].pcbs100)||"0"===a[g].pcbs100||"undefined"===a[g].pcbs100||(d+=0!==b[f]?60/b[f]*(c["product"+(g+1)][f]/a[g].pcbs100):0));e[f]=parseInt(100*d)}return console.log("totPercent:"+e),e}}).filter("calcAverageEff",function(){return function(a,b,c){for(var d=0,e=0,f=a;f<=b;f++)0!==c[f]&&(d+=parseInt(c[f]),e+=1);return 0!==d&&0!==e?(d/e).toFixed(0):0}}).filter("calcAvgEffTot",function(){return function(a,b){var c;return c=a*b!==0?((parseInt(a)+parseInt(b))/2).toFixed(0):parseInt(a)+parseInt(b)}}).filter("findPercent",function(){return function(a,b){return 0!==a?(100*a/b).toFixed(0):0}}).filter("getNames",function(){return function(a){var b=[],c=0;for(var d in a)a.hasOwnProperty(d)&&(b[c]=[a[d][0]],c++);return b}}).filter("getEff",function(){return function(a){var b=[],c=0;for(var d in a)a.hasOwnProperty(d)&&(b[c]=parseInt([a[d][3]]),c++);return b}}).filter("getLineOpened",function(){return function(a){var b=[];b[0]="Lin.Otwarta[min]";for(var c=1;c<a.length;c++)b[c]=60-a[c];return b}}).filter("calcLineEff",function(){return function(a,b){var c=[];c[0]="Lin.Eff.[min]";for(var d=1;d<a.length;d++)c[d]=(a[d]*b[d]/100).toFixed(0);return c}}).filter("getAllNames",function(){return function(a,b,c,d,e,f){var g=[];for(var h in a)g.push(b+h);for(h in c)g.push(d+h);for(h in e)g.push(f+h);return g}}).filter("convertDayInNumber",function(){return function(a,b){for(var c,d=moment(a),e=0;e<b.length;e++)b[e]===d.format("dddd")&&(c=e);return c}}).filter("calcWeeklyRecordsTot",function(){return function(a){for(var b=[],c=0,d=0;d<a.length;d++)if("lineEffTot"!==a[d].name&&(b[d]={name:a[d].name,text:a[d].text,calweek:a[d].calweek,values:[a[d].values.reduce(function(a,b){return parseInt(a)+parseInt(b)}),0]}),"lineEffTot"===a[d].name){for(var e=0;e<a[d].values.length;d++)0!==a[d].values[e]&&(c+=1);b[d]={name:a[d].name,text:a[d].text,calweek:a[d].calweek,values:[a[d].values.reduce(function(a,b){return(parseInt(a)+parseInt(b))/c}),0]}}return b}}).filter("calcWeeklyProductsTot",function(){return function(a){for(var b=[],c=0;c<a.length;c++)b[c]={productIndex:a[c].productIndex,calmonth:a[c].calweek,monthlyQuantity:[a[c].weeklyQuantity.reduce(function(a,b){return parseInt(a)+parseInt(b)}),0]};return b}}).filter("calcAvgEffWeeklyTot",function(){return function(a){for(var b,c=0,d=0;d<a.length;d++)0!==a[d]&&(c+=c);return b=a.reduce(function(a,b,c){return(parseInt(a)+parseInt(b))/c})}}).filter("calcStopsPercent",function(){return function(a,b,c,d){for(var e=0,f=0,g=0;g<a.length;g++)a[g].name===c&&(f=parseInt(a[g].values.reduce(function(a,b){return a+b})));for(var h=0;h<b.length;h++)if(console.log("num:"+f),console.log("name:"+d),b[h].name===d)return e=b[h].values.reduce(function(a,b){return a+b}),0!==f?(console.log("sum:"+e),(100*e/f).toFixed(0)):0}}).filter("calcWeeklyEff",function(){return function(a){for(var b=0,c=0,d=0;d<a.length;d++)if("prodDataTot.efficiencyTot"===a[d].name){for(var e=0;e<a[d].values.length;e++)0!==a[d].values[e]&&(b+=1);c=a[d].values.reduce(function(a,b){return parseInt(a)+parseInt(b)})}return 0!==b?(c/b).toFixed(0):0}}).filter("calcWeeklyClosed",function(){return function(a){for(var b=0,c=0,d=0;d<a.length;d++)"prodDataTot.lineClosedTot"===a[d].name&&(b=a[d].values[0]),"prodDataTot.lineOpenedTot"===a[d].name&&(c=a[d].values[0]);return 0!==c?(100*b/(c+b)).toFixed(0):0}}).filter("calcWeeklyLineOpened",function(){return function(a){for(var b=0,c=0,d=0;d<a.length;d++)"prodDataTot.lineOpenedTot"===a[d].name&&(c=parseInt(a[d].values[0])),"prodDataTot.lineClosedTot"===a[d].name&&(b=parseInt(a[d].values[0]));return 0!==b?(100*c/(c+b)).toFixed(0):0}}).filter("calcWeeklynpStops",function(){return function(a){for(var b=0,c=0,d=0;d<a.length;d++)"prodDataTot.npStopsTot"===a[d].name&&(b=parseInt(a[d].values[0])),"prodDataTot.lineEffTot"===a[d].name&&(c=parseInt(a[d].values[0]));return 0!==c?(100*b/(b+c)).toFixed(0):0}}).filter("calcWeeklyLineEff",function(){return function(a){for(var b=0,c=0,d=0;d<a.length;d++)"prodDataTot.lineEffTot"===a[d].name&&(c=parseInt(a[d].values[0])),"prodDataTot.npStopsTot"===a[d].name&&(b=parseInt(a[d].values[0]));return 0!==b?(100*c/(c+b)).toFixed(0):0}}).filter("getNamesFromArray",function(){var a=[];return function(b){for(var c=0;c<b.length;c++)a[c]=b[c].text;return a}}).filter("getStops",function(){var a=[];return function(b){for(var c=0;c<b.length;c++)a[c]=parseInt(b[c].values[1]);return a}}).filter("getWeeklyEff",function(){var a=[];return function(b){for(var c=0;c<b.length;c++)if("prodDataTot.efficiencyTot"===b[c].name)for(var d=0;d<b[c].values.length;d++)a[d]=parseInt(b[c].values[d]);return a}}).filter("findId",function(){return function(a,b){b.filter(function(b,c){return b._id===a})}}).filter("calcStops",function(){return function(a,b){for(var c=1;c<a.length;c++){a[c]=0;for(var d in b)b.hasOwnProperty(d)&&(a[c]+=parseInt(b[d][c+1]))}}}).filter("calcTot",function(){return function(a,b){for(var c=1;c<=8;c++)for(var d in a)a.hasOwnProperty(d)&&"efficiency"!==d&&"target"!==d&&(b[d+"Tot"][0]=a[d].filter(function(a,b,c){if(!isNaN(c[b])&&""!==c[b])return!0}).filter(function(a,b){if(b>=0&&b<=7)return!0}).reduce(function(a,b){return parseInt(a)+parseInt(b)}));for(c=9;c<=16;c++)for(var d in a)a.hasOwnProperty(d)&&"efficiency"!==d&&"target"!==d&&(b[d+"Tot"][1]=a[d].filter(function(a,b,c){if(!isNaN(c[b])&&""!==c[b])return!0}).filter(function(a,b){if(b>=8&&b<=16)return!0}).reduce(function(a,b){return parseInt(a)+parseInt(b)}),b[d+"Tot"][2]=b[d+"Tot"][0]+b[d+"Tot"][1])}}).filter("calcRatioProdData",function(a){return function(b){b.lineEffTot[3]=b.efficiencyTot[2],b.lineOpenedTot[3]=a("lineRatio")(b.lineOpenedTot[2],b.lineClosedTot[2]),b.lineClosedTot[3]=a("lineRatio")(b.lineClosedTot[2],b.lineOpenedTot[2]),b.npStopsTot[3]=a("lineRatio")(b.npStopsTot[2],b.lineEffTot[2])}}).filter("calcRatio",function(){return function(a,b,c){for(var d in a)a.hasOwnProperty(d)&&(0!==b[c][2]?a[d][3]=(100*a[d][2]/b[c][2]).toFixed(0):a[d][3]=0)}}).filter("addDays",function(){return function(a,b){var c=moment(a,"YYYY-MM-DD").add(b,"days").format("YYYY-MM-DD");return"undefined"===a?"":c}}).filter("checkForNumbers",function(){return function(a,b,c){var d=a.split(" ")[0]+b;return"pp1"!==d&&"np1"!==d||"pp1"!==d&&"np1"!==d&&void 0}});var services=angular.module("myApp.services",["ngResource"]),localhost="localhost:";services.factory("products",function(a){return a("http://"+localhost+"3000/products/:productIndex",{},{get:{method:"GET",params:{productIndex:"@productIndex"},isArray:!1}})}),services.factory("productService",function(a){return a("http://"+localhost+"3000/products/:id",{},{update:{method:"PUT",params:{id:"@id"}},delete:{method:"DELETE",params:{id:"@id"}}})}),services.factory("productsByOpis",function(a){return a("http://"+localhost+"3000/products/description/:description",{},{query:{method:"GET",params:{description:"@description"},isArray:!0}})}),services.factory("dailyRecord",function(a){return a("http://"+localhost+"3000/dailyrecords/:recordId",{},{get:{method:"GET",params:{recordId:"@recordId"},isArray:!1}})}),services.factory("dailyRecordByDate",function(a){return a("http://"+localhost+"3000/dailyrecords/bydate/:prodData",{},{query:{method:"GET",params:{
prodData:"@prodData"},isArray:!0}})}),services.factory("dailyRecordService",function(a){return a("http://"+localhost+"3000/dailyrecords/:recordId",{},{update:{method:"PUT",params:{recordId:"@recordId"}}})}),services.factory("dailyRecordServiceDel",function(a){return a("http://"+localhost+"3000/dailyrecords/:id",{},{delete:{method:"DELETE",params:{id:"@id"}}})}),services.factory("dailyProduct",function(a){return a("http://"+localhost+"3000/dailyproducts/:productIndex",{},{get:{method:"GET",params:{productIndex:"@productIndex"},isArray:!1}})}),services.factory("dailyProductByDate",function(a){return a("http://"+localhost+"3000/dailyproducts/bydate/:prodData",{},{update:{method:"GET",params:{prodData:"@prodData"},isArray:!0}})}),services.factory("dailyProductService",function(a){return a("http://"+localhost+"3000/dailyproducts/:id",{},{update:{method:"PUT",params:{id:"@id"}},delete:{method:"DELETE",params:{id:"@id"}}})}),services.factory("weeklyRecord",function(a){return a("http://"+localhost+"3000/weeklyrecords/:weeklyRecordId",{},{get:{method:"GET",params:{weeklyRecordId:"@weeklyRecordId"},isArray:!1},g:{method:"GET",params:{weeklyRecordId:"@weeklyRecordId"},isArray:!0}})}),services.factory("weeklyRecordForPeriod",function(a){return a("http://"+localhost+"3000/weeklyrecords/period/:date1/:date2",{},{update:{method:"GET",params:{date1:"@date1",date2:"@date2"},isArray:!0}})}),services.factory("weeklyRecordService",function(a){return a("http://"+localhost+"3000/weeklyrecords/:id",{},{update:{method:"PUT",params:{id:"@id"}},delete:{method:"DELETE",params:{id:"@id"}}})}),services.factory("weeklyProduct",function(a){return a("http://"+localhost+"3000/weeklyproducts/:recordId",{},{query:{method:"GET",params:{recordId:"@recordId"},isArray:!0}})}),services.factory("weeklyProductForData",function(a){return a("http://"+localhost+"3000/weeklyproducts/date/:prodData",{},{query:{method:"GET",params:{prodData:"@prodData"},isArray:!0}})}),services.factory("weeklyProductForPeriod",function(a){return a("http://"+localhost+"3000/weeklyproducts/period/:date1/:date2",{},{query:{method:"GET",params:{date1:"@date1",date2:"@date2"},isArray:!0}})}),services.factory("weeklyProductService",function(a){return a("http://"+localhost+"3000/weeklyproducts/:id",{},{update:{method:"PUT",params:{id:"@id"}},delete:{method:"DELETE",params:{id:"@id"}}})}),services.factory("SecurityService",["$http","$rootScope","$location",function(a,b,c,d){return{login:function(c,d){console.log("user in security Service:"+JSON.stringify(c)),a.post("http://"+localhost+"3000/login",c).success(function(a){b.currentUser=a,d(a)}).error(function(a){d(a)})},logout:function(d){a.post("http://"+localhost+"3000/logout").success(function(){b.currentUser=null,d(),c.url("/login")})}}}]),services.factory("columnChart",function(){return function(a,b,c,d){Highcharts.chart(d,{chart:{type:"column",options3d:{enabled:!0,alpha:10,beta:30,depth:40,borderColor:"#303030",frame:{back:{color:"#A3A3C2",size:4},bottom:{color:"#DBB8FF",size:10},side:{color:"#8099E6",size:2}}}},title:{text:""},xAxis:{categories:c},yAxis:{min:0,max:100,title:{text:"[%]"}},plotOptions:{series:{edgeColor:"#000000"},column:{borderColor:"black",zones:[{value:80,color:"#ff4000"},{color:"#00ff80"}]}},series:[{type:"column",name:"[%]",showInLegend:!1,data:a,borderColor:"black"}]})}}),services.factory("columnCharPP",function(){return function(a,b,c,d){Highcharts.chart(d,{chart:{type:"column",options3d:{enabled:!0,alpha:15,beta:15,depth:50}},title:{text:""},xAxis:{categories:c},yAxis:{min:0,max:100,title:{text:"[%]"}},series:[{type:"spline",name:"Target[%]",data:b,showInLegend:!1,lineColor:Highcharts.getOptions().colors[10]},{type:"column",name:"[%]",showInLegend:!1,data:a,color:Highcharts.getOptions().colors[9]}]})}}),services.factory("pieChart",function(){return function(a,b,c,d,e){Highcharts.chart(e,{chart:{type:"pie",options3d:{enabled:!0,alpha:45,beta:0}},title:{text:"",style:{display:"none"}},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:15,dataLabels:{enabled:!0,format:"{point.name}"}}},series:[{type:"pie",name:"",data:[{name:b,y:a,sliced:!0,selected:!0},[d,c]]}]})}}),services.factory("messages",["growl",function(a){return function(b){var c={};switch(b){case"success":a.success("Done!!!",c);break;case"add":a.info("Produkt jest dodany!!!",c);break;case"update":a.info("Produkt jest zaaktualizowany!!! ",c);break;case"delete":a.info("Produkt jest usunięty!",c);break;case"error":a.error("",c);break;case"wrongcode":a.error("Błędny kod !!!",c);break;case"Unauthorized":a.error("Wrong username or password!!!",c);break;case"userNotFound":a.info("User not found!!!",c);break;default:a.error("Pojawił się błąd, sprobuj ponownie!!!",c)}}}]);
